# A Primer on Next Generation Matrix Models

A Next Generation Matrix model is a way to model the expected number of infections generated by a typical infected individual in different groups or categories of the population in consecutive generations. The Next Generation Matrix (here after referred to as the NGM) encodes this information. NGM models are an effective way to model average dynamics in a heterogeneous population during the early growth phase and in the limit of the disease-free equilibrium.

An NGM model is related to the branching process concept of an offspring distribution generated by an individual. In this context, the NGM represents the expected value of the offspring distribution, or in this case, the distribution of infections caused in a group from a typical infectious individual in another group.

Some classic works on NGMs are:

Diekmann, O., Heesterbeek, J.A.P. & Metz, J.A.J. On the definition and the computation of the basic reproduction ratio R 0 in models for infectious diseases in heterogeneous populations. J. Math. Biol. 28, 365â€“382 (1990). https://doi.org/10.1007/BF00178324

Diekmann O, Heesterbeek JA, Roberts MG. The construction of next-generation matrices for compartmental epidemic models. J R Soc Interface. 2010 Jun 6;7(47):873-85. https://doi.org/10.1098/rsif.2009.0386. Epub 2009 Nov 5. PMID: 19892718; PMCID: PMC2871801.

This primer is meant to supplement these works and articulate how the NGM can be used in a transmission model in addition to being an analytical tool.

## Use of NGM as a model
Most commonly, NGMs are used in infectious disease modeling as an analytical tool to estimate the potential for growth of disease in a population. NGMs are particularly useful for this when a population can be split into a finite number of discrete categories with different epidemiologically relevant traits. In that case, we can define the NGM and use it calculate the basic reproduction number $R_0$, an epidemiological quantity that can help provide insight about the early growth of a disease in a population and interventions that may be effective at controlling its growth.

As a result, most modelers familiar with NGMs have experience with using them as an analytical tool rather than as a simulation tool. However, NGMs can also be used to approximately model the ODEs for the subsystem of infected states, where the unit of time is the infectious period.

## Interpretation of matrix elements
Imagine we have an NGM, **K** = [$k_{ij}$]. The elements $k_{ij}$ of this matrix can be interpreted as the average number of infections in group $i$ caused by an infected individual in group $j$ between consecutive generations. As a rule of thumb, the matrix **K** is not symmetric; some groups may be more susceptible to infection or more transmissive resulting in an asymmetric **K**.

## Conditions and limitations

<!-- NGMs can be used to estimate $R_0$ under certain conditions.  -->
Some conditions are required for NGM models to be a valid tool for estimating $R_0$ or as a simulation tool.

### Discrete states
The model population must be able to be divided into discrete compartments or states that are epidemiologically relevant. These strata may reflect heterogeneities in susceptibility, such as age, or health state, such as infectious and symptomatic vs. infectious and asymptomatic.

### The disease free equilibrium

The NGM is constructed by identifying transmission and transition dynamics of an infectious disease model near the disease-free equilibrium (DFE) and linearizing the system around that point.

A disease-free equilibrium (DFE) is a point in the epidemiological model where the population is free of disease, i.e. at a DFE the infectious population is zero. There can be multiple DFE for a system; the NGM is defined for when the population is fully susceptible. For example, in the classic SIR model, the DFE has the conditions $S \approx N$, $I \approx 0$, $R = 0$, which leads us to the condition $R_0 = \frac{\beta}{\gamma} \geq 1 $ for growth of disease in the population when we linearize the system around that point.


<!-- , the DFE corresponds to when the infectious population is zero and the population i -->

<!-- For example, in the classic SIR model, the DFE  -->

<!-- the DFE is $R_0 = \frac{\beta}{\gamma}$, which is found from the system of differential equations when we linearize around the point $I \approx 0$ ,$R = 0$, and thus $S \approx N$ in a population with fixed size $N$. -->

<!-- The disease-free equilibrium early in an outbreak has the conditions $S \approx N$, $S_H \approx N$, and $S_L \approx N_L$.  -->

### Depletion of susceptibles

NGM models describe infectious disease dynamics as a demographic process in the sense that each consecutive generation produces new offspring infections. This can be a good approximation for disease dynamics early on when the population can be roughly described as fully susceptible. However, unlike ODE models, an NGM model does not account for the fixed size of a population and cannot model the depletion of susceptibles over time.

<!-- Unlike ODE models where the population size can be fixed, an NGM model does not account for the fixed size of a population. and is not able to model the depletion of susceptibles over time.  -->

<!-- As a result of NGM models being derived from linearization near the DFE early on, an NGM model is a valid approximation for the early growth phase of an outbreak when infections are low and growth would continue uninterrupted if $R_0 \geq 1$.  -->

## Derivation from infectious disease dynamics
The following example is borrowed from Keeling & Rohani (2008, pp 57-63). Here, we go into it in more depth with additional insights from Diekmann et al (2010).

Consider the dynamics of a disease spreading in a population with two categories of individuals; a high-risk and a low-risk group.  The disease dynamics can be described using an SIR compartmental model, however the two groups have some differences in their risk for acquiring disease. An NGM is an effective way of approximating the early disease dynamics for heterogeneous systems like this.

We denote the number of individuals in the high-risk group as $N_H$, and the number of individuals in the low-risk group as $N_L$. The total population is fixed for size $N$ = $N_H + N_L$. $X_H$ is the number of people in group $H$ who are in health state $X$, and the total number of people in health state $X$ = $X_H + X_L$. Health states in this model are $S$ for susceptible, $I$ for infected and infectious, and $R$ for recovered.

Individuals in the two risk groups can interact with each other in some way such that if an infectious individual was in this population we would expect some number of infections to be generated in the two groups. Individuals in each risk group can also recover from infection at some rate $\gamma$ (here we assume that high-risk and low-risk individuals recover at the same rate, however the following can be generalized to scenarios where average recovery rates of the two groups are different).

New infections in the high-risk group can be modeled as $\beta'_{HH}S_H I_H + \beta'_{HL}S_H I_L$, where $\beta'_{ij}$ is the number of infections generated by group $j$ in group $i$. Similarly, new infections in the low-risk group can be modeled as $\beta'_{LH}S_L I_H + \beta'_{LL}S_L I_L$. Assuming infectious individuals recover at some average constant rate $\gamma$ , we can write the differential equation for the infectious states as

$\frac{dI_H}{dt} = \beta'_{HH}S_H I_H + \beta'_{HL}S_H I_L - \gamma I_H$

$\frac{dI_L}{dt} = \beta'_{LH}S_L I_H + \beta'_{LL}S_L I_L - \gamma I_L$

We can redefine all rates of change so that $\gamma$ is the unit of time ($\gamma = 1$). Then the equations become

$\frac{dI_H}{dt} = \beta_{HH}S_H I_H + \beta_{HL}S_H I_L - I_H$

$\frac{dI_L}{dt} = \beta_{LH}S_L I_H + \beta_{LL}S_L I_L - I_L$

where $\beta_{ij}$ is the rate of new infections generated by group $j$ in group $i$ per unit time $\gamma$.





<!-- ## Building up from the SIR model -->

## Contact matrices

### Example: homogeneous mixing as a pairwise model

### Example: proportionate group mixing



## Formal definition

### The F and V matrix

## When population sizes are different

## When distributions of population groups vary



<!-- [Use of NGM as a model](#use-of-ngm-as-a-model) -->

<!-- [Interpretation of matrix elements](#interpretation-of-matrix-elements) -->

<!-- [Explanatory comma: Frequency vs Density dependent models](#explanatory-comma-frequency-vs-density-dependent-models) -->

<!-- [Building up from the SIR model](#building-up-from-the-sir-model) -->

<!-- [Derivation from infectious disease dynamics](#derivation-from-infectious-disease-dynamics) -->

<!-- [Contact matrices](#contact-matrices) -->

<!-- [Example: homogeneous mixing](#example-homogeneous-mixing-as-a-pairwise-model) -->

<!-- ### Explanatory comma: Frequency vs Density dependent models -->

<!-- [Example: proportionate group mixing](#example-proportionate-group-mixing) -->

<!-- [Conditions and limitations](#conditions-and-limitations) -->

<!-- [Formal definition](#formal-definition) -->

<!-- [The F and V matrix](#the-f-and-v-matrix) -->

<!-- [When population sizes are different](#when-population-sizes-are-different) -->

<!-- [When distributions of population groups vary](#when-distributions-of-population-groups-vary) -->
